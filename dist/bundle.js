(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Grid_1 = require("./Grid");
var View_1 = require("./View");
var Snake_1 = require("./Snake");
var Game = /** @class */ (function () {
    function Game() {
        this.frame = 0;
        this.score = 0;
        this.speed = constants_1.START_SPEED;
        this.direction = constants_1.DIRECTION.RIGHT;
        this.isChangeDirectionAllowed = true;
        this.grid = new Grid_1.default();
        this.view = new View_1.default(this.grid.columnsQuantity, this.grid.rowsQuantity);
        this.snake = new Snake_1.default(this.grid);
        window.addEventListener('keydown', this.onKeyDown.bind(this));
        this.generateApple();
    }
    Game.prototype.start = function () {
        window.focus();
        window.requestAnimationFrame(this.startLoop.bind(this));
    };
    Game.prototype.onKeyDown = function (event) {
        if (!this.isChangeDirectionAllowed) {
            return;
        }
        this.isChangeDirectionAllowed = false;
        switch (event.keyCode) {
            case constants_1.KEY_CODE.RIGHT:
                if (this.direction !== constants_1.DIRECTION.LEFT) {
                    this.direction = constants_1.DIRECTION.RIGHT;
                }
                break;
            case constants_1.KEY_CODE.LEFT:
                if (this.direction !== constants_1.DIRECTION.RIGHT) {
                    this.direction = constants_1.DIRECTION.LEFT;
                }
                break;
            case constants_1.KEY_CODE.UP:
                if (this.direction !== constants_1.DIRECTION.DOWN) {
                    this.direction = constants_1.DIRECTION.UP;
                }
                break;
            case constants_1.KEY_CODE.DOWN:
                if (this.direction !== constants_1.DIRECTION.UP) {
                    this.direction = constants_1.DIRECTION.DOWN;
                }
                break;
        }
    };
    Game.prototype.generateApple = function () {
        var emptyCoordinates = this.getEmptyCoordinates();
        var foodCoordinate = emptyCoordinates[Math.floor(Math.random() * (emptyCoordinates.length - 1))];
        this.grid.setCell(foodCoordinate, constants_1.CELL_TYPE.APPLE);
    };
    Game.prototype.getEmptyCoordinates = function () {
        var emptyCoordinates = [];
        for (var row = 0; row < this.grid.rowsQuantity; row++) {
            for (var column = 0; column < this.grid.columnsQuantity; column++) {
                if (this.grid.getCell({ row: row, column: column }) === constants_1.CELL_TYPE.EMPTY) {
                    emptyCoordinates.push({ row: row, column: column });
                }
            }
        }
        return emptyCoordinates;
    };
    Game.prototype.startLoop = function () {
        if (++this.frame % this.speed !== 0) {
            window.requestAnimationFrame(this.startLoop.bind(this));
            return;
        }
        var headRow = this.snake.head.row;
        var headColumn = this.snake.head.column;
        switch (this.direction) {
            case constants_1.DIRECTION.RIGHT:
                headColumn++;
                break;
            case constants_1.DIRECTION.LEFT:
                headColumn--;
                break;
            case constants_1.DIRECTION.UP:
                headRow--;
                break;
            case constants_1.DIRECTION.DOWN:
                headRow++;
                break;
        }
        if (this.checkGameOver({ row: headRow, column: headColumn })) {
            // todo handle game over
            return;
        }
        var isGetApple = this.grid.getCell({ row: headRow, column: headColumn }) === constants_1.CELL_TYPE.APPLE;
        if (isGetApple) {
            this.snake.eat({ row: headRow, column: headColumn });
            this.generateApple();
            this.updateScore(++this.score);
        }
        this.snake.move({ row: headRow, column: headColumn });
        this.view.draw(this.grid.grid);
        this.isChangeDirectionAllowed = true;
        window.requestAnimationFrame(this.startLoop.bind(this));
    };
    Game.prototype.updateScore = function (score) {
        if (this.score % constants_1.SPEED_INCREASE_INTERVAL === 0) {
            this.speed--;
        }
        this.view.updateScore(this.score);
    };
    Game.prototype.checkGameOver = function (snakeHead) {
        var isTouchedBorder = snakeHead.row < 0 || snakeHead.column < 0 || snakeHead.row > this.grid.rowsQuantity - 1 || snakeHead.column > this.grid.columnsQuantity - 1;
        var isTouchedHerself = this.grid.getCell(snakeHead) === constants_1.CELL_TYPE.SNAKE;
        return isTouchedBorder || isTouchedHerself;
    };
    return Game;
}());
exports.default = Game;

},{"../shared/constants":6,"./Grid":2,"./Snake":3,"./View":4}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Grid = /** @class */ (function () {
    function Grid() {
        this._grid = [];
        this._cols = Math.round(window.innerWidth / constants_1.CELL_SIZE) - constants_1.GRID_MARGIN;
        this._rows = Math.round(window.innerHeight / constants_1.CELL_SIZE) - constants_1.GRID_MARGIN;
        for (var row = 0; row < this._rows; row++) {
            this._grid[row] = [];
            for (var column = 0; column < this._cols; column++) {
                this._grid[row][column] = constants_1.CELL_TYPE.EMPTY;
            }
        }
    }
    Object.defineProperty(Grid.prototype, "columnsQuantity", {
        get: function () {
            return this._cols;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "rowsQuantity", {
        get: function () {
            return this._rows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "grid", {
        get: function () {
            return this._grid;
        },
        enumerable: true,
        configurable: true
    });
    Grid.prototype.getCell = function (coordinate) {
        return this._grid[coordinate.row][coordinate.column];
    };
    Grid.prototype.setCell = function (coordinate, type) {
        this._grid[coordinate.row][coordinate.column] = type;
    };
    return Grid;
}());
exports.default = Grid;

},{"../shared/constants":6}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Snake = /** @class */ (function () {
    function Snake(grid) {
        this.grid = grid;
        this.chain = [];
        this.chain.push(constants_1.START_SNAKE_COORDINATE);
    }
    Object.defineProperty(Snake.prototype, "head", {
        get: function () {
            return this.chain[0];
        },
        enumerable: true,
        configurable: true
    });
    Snake.prototype.eat = function (coordinate) {
        this.chain.unshift(coordinate);
        this.grid.setCell(coordinate, constants_1.CELL_TYPE.SNAKE);
    };
    Snake.prototype.move = function (coordinate) {
        this.chain.unshift(coordinate);
        this.grid.setCell(coordinate, constants_1.CELL_TYPE.SNAKE);
        var nextCoordinate = {
            row: this.chain[this.chain.length - 1].row,
            column: this.chain[this.chain.length - 1].column
        };
        this.grid.setCell(nextCoordinate, constants_1.CELL_TYPE.EMPTY);
        this.chain.pop();
    };
    return Snake;
}());
exports.default = Snake;

},{"../shared/constants":6}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var View = /** @class */ (function () {
    function View(cols, rows) {
        this.cols = cols;
        this.rows = rows;
        this.canvas = document.getElementsByClassName('battlefield')[0];
        this.canvas.setAttribute('width', this.cols * constants_1.CELL_SIZE + "px");
        this.canvas.setAttribute('height', this.rows * constants_1.CELL_SIZE + "px");
        this.ctx = this.canvas.getContext('2d');
    }
    View.prototype.draw = function (grid) {
        var _this = this;
        grid.forEach(function (rowArr, row) {
            rowArr.forEach(function (type, column) {
                _this.drawCell({ row: row, column: column }, type);
            });
        });
    };
    View.prototype.updateScore = function (score) {
        // todo implement score draw
    };
    View.hideStartScreen = function () {
        document.getElementsByClassName('start-screen')[0].style.display = 'none';
    };
    View.prototype.drawCell = function (coordinate, type) {
        this.ctx.fillStyle = constants_1.COLOR[type] || constants_1.COLOR[constants_1.CELL_TYPE.EMPTY];
        this.ctx.fillRect(coordinate.column * constants_1.CELL_SIZE, coordinate.row * constants_1.CELL_SIZE, constants_1.CELL_SIZE, constants_1.CELL_SIZE);
    };
    ;
    return View;
}());
exports.default = View;

},{"../shared/constants":6}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Game_1 = require("./controllers/Game");
var View_1 = require("./controllers/View");
var game = new Game_1.default();
var startButton = document.getElementsByClassName('start-screen__button')[0];
startButton.addEventListener('click', function () {
    View_1.default.hideStartScreen();
    game.start();
});

},{"./controllers/Game":1,"./controllers/View":4}],6:[function(require,module,exports){
"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CELL_SIZE = 20;
exports.GRID_MARGIN = 6;
exports.START_SPEED = 10;
exports.SPEED_INCREASE_INTERVAL = 5;
exports.START_SNAKE_COORDINATE = {
    row: 3,
    column: 3
};
var KEY_CODE;
(function (KEY_CODE) {
    KEY_CODE[KEY_CODE["LEFT"] = 37] = "LEFT";
    KEY_CODE[KEY_CODE["UP"] = 38] = "UP";
    KEY_CODE[KEY_CODE["RIGHT"] = 39] = "RIGHT";
    KEY_CODE[KEY_CODE["DOWN"] = 40] = "DOWN";
})(KEY_CODE = exports.KEY_CODE || (exports.KEY_CODE = {}));
var CELL_TYPE;
(function (CELL_TYPE) {
    CELL_TYPE[CELL_TYPE["EMPTY"] = 0] = "EMPTY";
    CELL_TYPE[CELL_TYPE["SNAKE"] = 1] = "SNAKE";
    CELL_TYPE[CELL_TYPE["APPLE"] = 2] = "APPLE";
    CELL_TYPE[CELL_TYPE["CRASH"] = 3] = "CRASH";
})(CELL_TYPE = exports.CELL_TYPE || (exports.CELL_TYPE = {}));
var DIRECTION;
(function (DIRECTION) {
    DIRECTION[DIRECTION["RIGHT"] = 0] = "RIGHT";
    DIRECTION[DIRECTION["LEFT"] = 1] = "LEFT";
    DIRECTION[DIRECTION["DOWN"] = 2] = "DOWN";
    DIRECTION[DIRECTION["UP"] = 3] = "UP";
})(DIRECTION = exports.DIRECTION || (exports.DIRECTION = {}));
exports.COLOR = (_a = {},
    _a[CELL_TYPE.SNAKE] = 'green',
    _a[CELL_TYPE.APPLE] = 'red',
    _a[CELL_TYPE.CRASH] = 'darkred',
    _a[CELL_TYPE.EMPTY] = 'white',
    _a);

},{}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29udHJvbGxlcnMvR2FtZS50cyIsInNyYy9jb250cm9sbGVycy9HcmlkLnRzIiwic3JjL2NvbnRyb2xsZXJzL1NuYWtlLnRzIiwic3JjL2NvbnRyb2xsZXJzL1ZpZXcudHMiLCJzcmMvbWFpbi50cyIsInNyYy9zaGFyZWQvY29uc3RhbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxpREFBMkc7QUFDM0csK0JBQTBCO0FBQzFCLCtCQUEwQjtBQUMxQixpQ0FBNEI7QUFHNUI7SUFVSTtRQU5RLFVBQUssR0FBVyxDQUFDLENBQUM7UUFDbEIsVUFBSyxHQUFXLENBQUMsQ0FBQztRQUNsQixVQUFLLEdBQVcsdUJBQVcsQ0FBQztRQUM1QixjQUFTLEdBQWMscUJBQVMsQ0FBQyxLQUFLLENBQUM7UUFDdkMsNkJBQXdCLEdBQVksSUFBSSxDQUFDO1FBRzdDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxjQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGVBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRTlELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQsb0JBQUssR0FBTDtRQUNJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNmLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJ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QiwyQ0FBSyxDQUFBO0lBQ0wsMkNBQUssQ0FBQTtJQUNMLDJDQUFLLENBQUE7SUFDTCwyQ0FBSyxDQUFBO0FBQ1QsQ0FBQyxFQUxXLFNBQVMsR0FBVCxpQkFBUyxLQUFULGlCQUFTLFFBS3BCO0FBRUQsSUFBWSxTQUtYO0FBTEQsV0FBWSxTQUFTO0lBQ2pCLDJDQUFLLENBQUE7SUFDTCx5Q0FBSSxDQUFBO0lBQ0oseUNBQUksQ0FBQTtJQUNKLHFDQUFFLENBQUE7QUFDTixDQUFDLEVBTFcsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFLcEI7QUFFWSxRQUFBLEtBQUs7SUFDZCxHQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUcsT0FBTztJQUMxQixHQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUcsS0FBSztJQUN4QixHQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUcsU0FBUztJQUM1QixHQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUcsT0FBTztRQUM1QiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImltcG9ydCB7IENFTExfVFlQRSwgRElSRUNUSU9OLCBLRVlfQ09ERSwgU1BFRURfSU5DUkVBU0VfSU5URVJWQUwsIFNUQVJUX1NQRUVEIH0gZnJvbSBcIi4uL3NoYXJlZC9jb25zdGFudHNcIjtcbmltcG9ydCBHcmlkIGZyb20gXCIuL0dyaWRcIjtcbmltcG9ydCBWaWV3IGZyb20gXCIuL1ZpZXdcIjtcbmltcG9ydCBTbmFrZSBmcm9tIFwiLi9TbmFrZVwiO1xuaW1wb3J0IElDb29yZGluYXRlIGZyb20gXCIuLi9zaGFyZWQvSUNvb3JkaW5hdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XG4gICAgcHJpdmF0ZSByZWFkb25seSB2aWV3OiBWaWV3O1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZ3JpZDogR3JpZDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNuYWtlOiBTbmFrZTtcbiAgICBwcml2YXRlIGZyYW1lOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgc2NvcmU6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBzcGVlZDogbnVtYmVyID0gU1RBUlRfU1BFRUQ7XG4gICAgcHJpdmF0ZSBkaXJlY3Rpb246IERJUkVDVElPTiA9IERJUkVDVElPTi5SSUdIVDtcbiAgICBwcml2YXRlIGlzQ2hhbmdlRGlyZWN0aW9uQWxsb3dlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5ncmlkID0gbmV3IEdyaWQoKTtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IFZpZXcodGhpcy5ncmlkLmNvbHVtbnNRdWFudGl0eSwgdGhpcy5ncmlkLnJvd3NRdWFudGl0eSk7XG4gICAgICAgIHRoaXMuc25ha2UgPSBuZXcgU25ha2UodGhpcy5ncmlkKTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMub25LZXlEb3duLmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVBcHBsZSgpO1xuICAgIH1cblxuICAgIHN0YXJ0KCk6IHZvaWQge1xuICAgICAgICB3aW5kb3cuZm9jdXMoKTtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnN0YXJ0TG9vcC5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIHByaXZhdGUgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5pc0NoYW5nZURpcmVjdGlvbkFsbG93ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNDaGFuZ2VEaXJlY3Rpb25BbGxvd2VkID0gZmFsc2U7XG5cbiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEtFWV9DT0RFLlJJR0hUOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiAhPT0gRElSRUNUSU9OLkxFRlQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBESVJFQ1RJT04uUklHSFQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLRVlfQ09ERS5MRUZUOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiAhPT0gRElSRUNUSU9OLlJJR0hUKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gRElSRUNUSU9OLkxFRlQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLRVlfQ09ERS5VUDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT09IERJUkVDVElPTi5ET1dOKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gRElSRUNUSU9OLlVQO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS0VZX0NPREUuRE9XTjpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT09IERJUkVDVElPTi5VUCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IERJUkVDVElPTi5ET1dOO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2VuZXJhdGVBcHBsZSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZW1wdHlDb29yZGluYXRlczogSUNvb3JkaW5hdGVbXSA9IHRoaXMuZ2V0RW1wdHlDb29yZGluYXRlcygpO1xuICAgICAgICBjb25zdCBmb29kQ29vcmRpbmF0ZTogSUNvb3JkaW5hdGUgPSBlbXB0eUNvb3JkaW5hdGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChlbXB0eUNvb3JkaW5hdGVzLmxlbmd0aCAtIDEpKV07XG5cbiAgICAgICAgdGhpcy5ncmlkLnNldENlbGwoZm9vZENvb3JkaW5hdGUsIENFTExfVFlQRS5BUFBMRSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRFbXB0eUNvb3JkaW5hdGVzKCk6IElDb29yZGluYXRlW10ge1xuICAgICAgICBjb25zdCBlbXB0eUNvb3JkaW5hdGVzOiBJQ29vcmRpbmF0ZVtdID0gW107XG5cbiAgICAgICAgZm9yIChsZXQgcm93OiBudW1iZXIgPSAwOyByb3cgPCB0aGlzLmdyaWQucm93c1F1YW50aXR5OyByb3crKykge1xuICAgICAgICAgICAgZm9yIChsZXQgY29sdW1uOiBudW1iZXIgPSAwOyBjb2x1bW4gPCB0aGlzLmdyaWQuY29sdW1uc1F1YW50aXR5OyBjb2x1bW4rKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQuZ2V0Q2VsbCh7IHJvdywgY29sdW1uIH0pID09PSBDRUxMX1RZUEUuRU1QVFkpIHtcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlDb29yZGluYXRlcy5wdXNoKHsgcm93LCBjb2x1bW4gfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVtcHR5Q29vcmRpbmF0ZXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydExvb3AoKTogdm9pZCB7XG4gICAgICAgIGlmICgrK3RoaXMuZnJhbWUgJSB0aGlzLnNwZWVkICE9PSAwKSB7XG4gICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuc3RhcnRMb29wLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRSb3c6IG51bWJlciA9IHRoaXMuc25ha2UuaGVhZC5yb3c7XG4gICAgICAgIGxldCBoZWFkQ29sdW1uOiBudW1iZXIgPSB0aGlzLnNuYWtlLmhlYWQuY29sdW1uO1xuXG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgRElSRUNUSU9OLlJJR0hUOlxuICAgICAgICAgICAgICAgIGhlYWRDb2x1bW4rKztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRElSRUNUSU9OLkxFRlQ6XG4gICAgICAgICAgICAgICAgaGVhZENvbHVtbi0tO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBESVJFQ1RJT04uVVA6XG4gICAgICAgICAgICAgICAgaGVhZFJvdy0tO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBESVJFQ1RJT04uRE9XTjpcbiAgICAgICAgICAgICAgICBoZWFkUm93Kys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGVja0dhbWVPdmVyKHsgcm93OiBoZWFkUm93LCBjb2x1bW46IGhlYWRDb2x1bW4gfSkpIHtcbiAgICAgICAgICAgIC8vIHRvZG8gaGFuZGxlIGdhbWUgb3ZlclxuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc0dldEFwcGxlOiBib29sZWFuID0gdGhpcy5ncmlkLmdldENlbGwoeyByb3c6IGhlYWRSb3csIGNvbHVtbjogaGVhZENvbHVtbiB9KSA9PT0gQ0VMTF9UWVBFLkFQUExFO1xuXG4gICAgICAgIGlmIChpc0dldEFwcGxlKSB7XG4gICAgICAgICAgICB0aGlzLnNuYWtlLmVhdCh7IHJvdzogaGVhZFJvdywgY29sdW1uOiBoZWFkQ29sdW1uIH0pO1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUFwcGxlKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNjb3JlKCsrdGhpcy5zY29yZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNuYWtlLm1vdmUoeyByb3c6IGhlYWRSb3csIGNvbHVtbjogaGVhZENvbHVtbiB9KTtcblxuICAgICAgICB0aGlzLnZpZXcuZHJhdyh0aGlzLmdyaWQuZ3JpZCk7XG4gICAgICAgIHRoaXMuaXNDaGFuZ2VEaXJlY3Rpb25BbGxvd2VkID0gdHJ1ZTtcblxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuc3RhcnRMb29wLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlU2NvcmUoc2NvcmU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zY29yZSAlIFNQRUVEX0lOQ1JFQVNFX0lOVEVSVkFMID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNwZWVkLS07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnZpZXcudXBkYXRlU2NvcmUodGhpcy5zY29yZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0dhbWVPdmVyKHNuYWtlSGVhZDogSUNvb3JkaW5hdGUpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgaXNUb3VjaGVkQm9yZGVyOiBib29sZWFuID0gc25ha2VIZWFkLnJvdyA8IDAgfHwgc25ha2VIZWFkLmNvbHVtbiA8IDAgfHwgc25ha2VIZWFkLnJvdyA+IHRoaXMuZ3JpZC5yb3dzUXVhbnRpdHkgLSAxIHx8IHNuYWtlSGVhZC5jb2x1bW4gPiB0aGlzLmdyaWQuY29sdW1uc1F1YW50aXR5IC0gMTtcbiAgICAgICAgY29uc3QgaXNUb3VjaGVkSGVyc2VsZjogYm9vbGVhbiA9IHRoaXMuZ3JpZC5nZXRDZWxsKHNuYWtlSGVhZCkgPT09IENFTExfVFlQRS5TTkFLRTtcblxuICAgICAgICByZXR1cm4gaXNUb3VjaGVkQm9yZGVyIHx8IGlzVG91Y2hlZEhlcnNlbGY7XG4gICAgfVxufVxuXG4iLCJpbXBvcnQgeyBDRUxMX1NJWkUsIENFTExfVFlQRSwgR1JJRF9NQVJHSU4gfSBmcm9tIFwiLi4vc2hhcmVkL2NvbnN0YW50c1wiO1xuaW1wb3J0IElDb29yZGluYXRlIGZyb20gXCIuLi9zaGFyZWQvSUNvb3JkaW5hdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR3JpZCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfZ3JpZDogQ0VMTF9UWVBFW11bXSA9IFtdO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2NvbHM6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9yb3dzOiBudW1iZXI7XG5cbiAgICBnZXQgY29sdW1uc1F1YW50aXR5KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xzO1xuICAgIH1cblxuICAgIGdldCByb3dzUXVhbnRpdHkoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jvd3M7XG4gICAgfVxuXG4gICAgZ2V0IGdyaWQoKTogQ0VMTF9UWVBFW11bXSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ncmlkO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9jb2xzID0gTWF0aC5yb3VuZCh3aW5kb3cuaW5uZXJXaWR0aCAvIENFTExfU0laRSkgLSBHUklEX01BUkdJTjtcbiAgICAgICAgdGhpcy5fcm93cyA9IE1hdGgucm91bmQod2luZG93LmlubmVySGVpZ2h0IC8gQ0VMTF9TSVpFKSAtIEdSSURfTUFSR0lOO1xuXG4gICAgICAgIGZvciAobGV0IHJvdzogbnVtYmVyID0gMDsgcm93IDwgdGhpcy5fcm93czsgcm93KyspIHtcbiAgICAgICAgICAgIHRoaXMuX2dyaWRbcm93XSA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBjb2x1bW46IG51bWJlciA9IDA7IGNvbHVtbiA8IHRoaXMuX2NvbHM7IGNvbHVtbisrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZ3JpZFtyb3ddW2NvbHVtbl0gPSBDRUxMX1RZUEUuRU1QVFk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDZWxsKGNvb3JkaW5hdGU6IElDb29yZGluYXRlKTogQ0VMTF9UWVBFIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dyaWRbY29vcmRpbmF0ZS5yb3ddW2Nvb3JkaW5hdGUuY29sdW1uXTtcbiAgICB9XG5cbiAgICBzZXRDZWxsKGNvb3JkaW5hdGU6IElDb29yZGluYXRlLCB0eXBlOiBDRUxMX1RZUEUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fZ3JpZFtjb29yZGluYXRlLnJvd11bY29vcmRpbmF0ZS5jb2x1bW5dID0gdHlwZTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDRUxMX1RZUEUsIFNUQVJUX1NOQUtFX0NPT1JESU5BVEUgfSBmcm9tIFwiLi4vc2hhcmVkL2NvbnN0YW50c1wiO1xuaW1wb3J0IEdyaWQgZnJvbSBcIi4vR3JpZFwiO1xuaW1wb3J0IElDb29yZGluYXRlIGZyb20gXCIuLi9zaGFyZWQvSUNvb3JkaW5hdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU25ha2Uge1xuICAgIHByaXZhdGUgY2hhaW46IElDb29yZGluYXRlW10gPSBbXTtcblxuICAgIGdldCBoZWFkKCk6IElDb29yZGluYXRlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhaW5bMF07XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBncmlkOiBHcmlkKSB7XG4gICAgICAgIHRoaXMuY2hhaW4ucHVzaChTVEFSVF9TTkFLRV9DT09SRElOQVRFKTtcbiAgICB9XG5cbiAgICBlYXQoY29vcmRpbmF0ZTogSUNvb3JkaW5hdGUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jaGFpbi51bnNoaWZ0KGNvb3JkaW5hdGUpO1xuICAgICAgICB0aGlzLmdyaWQuc2V0Q2VsbChjb29yZGluYXRlLCBDRUxMX1RZUEUuU05BS0UpO1xuICAgIH1cblxuICAgIG1vdmUoY29vcmRpbmF0ZTogSUNvb3JkaW5hdGUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jaGFpbi51bnNoaWZ0KGNvb3JkaW5hdGUpO1xuICAgICAgICB0aGlzLmdyaWQuc2V0Q2VsbChjb29yZGluYXRlLCBDRUxMX1RZUEUuU05BS0UpO1xuXG4gICAgICAgIGNvbnN0IG5leHRDb29yZGluYXRlOiBJQ29vcmRpbmF0ZSA9IHtcbiAgICAgICAgICAgIHJvdzogdGhpcy5jaGFpblt0aGlzLmNoYWluLmxlbmd0aCAtIDFdLnJvdyxcbiAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jaGFpblt0aGlzLmNoYWluLmxlbmd0aCAtIDFdLmNvbHVtblxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ3JpZC5zZXRDZWxsKG5leHRDb29yZGluYXRlLCBDRUxMX1RZUEUuRU1QVFkpO1xuICAgICAgICB0aGlzLmNoYWluLnBvcCgpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENFTExfU0laRSwgQ0VMTF9UWVBFLCBDT0xPUiB9IGZyb20gXCIuLi9zaGFyZWQvY29uc3RhbnRzXCI7XG5pbXBvcnQgSUNvb3JkaW5hdGUgZnJvbSBcIi4uL3NoYXJlZC9JQ29vcmRpbmF0ZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaWV3IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29sczogbnVtYmVyLCBwcml2YXRlIHJlYWRvbmx5IHJvd3M6IG51bWJlcikge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IDxIVE1MQ2FudmFzRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdiYXR0bGVmaWVsZCcpWzBdO1xuICAgICAgICB0aGlzLmNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7dGhpcy5jb2xzICogQ0VMTF9TSVpFfXB4YCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgYCR7dGhpcy5yb3dzICogQ0VMTF9TSVpFfXB4YCk7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB9XG5cbiAgICBkcmF3KGdyaWQ6IENFTExfVFlQRVtdW10pOiB2b2lkIHtcbiAgICAgICAgZ3JpZC5mb3JFYWNoKChyb3dBcnI6IFtdLCByb3c6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgcm93QXJyLmZvckVhY2goKHR5cGU6IENFTExfVFlQRSwgY29sdW1uOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdDZWxsKHsgcm93LCBjb2x1bW4gfSwgdHlwZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlU2NvcmUoc2NvcmU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICAvLyB0b2RvIGltcGxlbWVudCBzY29yZSBkcmF3XG4gICAgfVxuXG4gICAgc3RhdGljIGhpZGVTdGFydFNjcmVlbigpOiB2b2lkIHtcbiAgICAgICAgKDxIVE1MRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzdGFydC1zY3JlZW4nKVswXSkuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG5cbiAgICBwcml2YXRlIGRyYXdDZWxsKGNvb3JkaW5hdGU6IElDb29yZGluYXRlLCB0eXBlOiBDRUxMX1RZUEUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gQ09MT1JbdHlwZV0gfHwgQ09MT1JbQ0VMTF9UWVBFLkVNUFRZXTtcbiAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoY29vcmRpbmF0ZS5jb2x1bW4gKiBDRUxMX1NJWkUsIGNvb3JkaW5hdGUucm93ICogQ0VMTF9TSVpFLCBDRUxMX1NJWkUsIENFTExfU0laRSk7XG4gICAgfTtcbn1cbiIsImltcG9ydCBHYW1lIGZyb20gJy4vY29udHJvbGxlcnMvR2FtZSc7XG5pbXBvcnQgVmlldyBmcm9tIFwiLi9jb250cm9sbGVycy9WaWV3XCI7XG5cbmNvbnN0IGdhbWUgPSBuZXcgR2FtZSgpO1xuY29uc3Qgc3RhcnRCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3RhcnQtc2NyZWVuX19idXR0b24nKVswXTtcblxuc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgVmlldy5oaWRlU3RhcnRTY3JlZW4oKTtcbiAgICBnYW1lLnN0YXJ0KCk7XG59KTtcbiIsImltcG9ydCBJQ29vcmRpbmF0ZSBmcm9tIFwiLi9JQ29vcmRpbmF0ZVwiO1xuXG5leHBvcnQgY29uc3QgQ0VMTF9TSVpFOiBudW1iZXIgPSAyMDtcbmV4cG9ydCBjb25zdCBHUklEX01BUkdJTjogbnVtYmVyID0gNjtcbmV4cG9ydCBjb25zdCBTVEFSVF9TUEVFRDogbnVtYmVyID0gMTA7XG5leHBvcnQgY29uc3QgU1BFRURfSU5DUkVBU0VfSU5URVJWQUw6IG51bWJlciA9IDU7XG5leHBvcnQgY29uc3QgU1RBUlRfU05BS0VfQ09PUkRJTkFURTogSUNvb3JkaW5hdGUgPSB7XG4gICAgcm93OiAzLFxuICAgIGNvbHVtbjogM1xufTtcblxuZXhwb3J0IGVudW0gS0VZX0NPREUge1xuICAgIExFRlQgPSAzNyxcbiAgICBVUCA9IDM4LFxuICAgIFJJR0hUID0gMzksXG4gICAgRE9XTiA9IDQwXG59XG5cbmV4cG9ydCBlbnVtIENFTExfVFlQRSB7XG4gICAgRU1QVFksXG4gICAgU05BS0UsXG4gICAgQVBQTEUsXG4gICAgQ1JBU0hcbn1cblxuZXhwb3J0IGVudW0gRElSRUNUSU9OIHtcbiAgICBSSUdIVCxcbiAgICBMRUZULFxuICAgIERPV04sXG4gICAgVVBcbn1cblxuZXhwb3J0IGNvbnN0IENPTE9SID0ge1xuICAgIFtDRUxMX1RZUEUuU05BS0VdOiAnZ3JlZW4nLFxuICAgIFtDRUxMX1RZUEUuQVBQTEVdOiAncmVkJyxcbiAgICBbQ0VMTF9UWVBFLkNSQVNIXTogJ2RhcmtyZWQnLFxuICAgIFtDRUxMX1RZUEUuRU1QVFldOiAnd2hpdGUnXG59O1xuIl19
