(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Grid_1 = require("./Grid");
var View_1 = require("./View");
var Snake_1 = require("./Snake");
var Game = /** @class */ (function () {
    function Game() {
        this.frame = 0;
        this.score = 0;
        this.speed = constants_1.START_SPEED;
        this.direction = constants_1.DIRECTION.RIGHT;
        this.isChangeDirectionAllowed = true;
        this.grid = new Grid_1.default();
        this.view = new View_1.default(this.grid.columnsQuantity, this.grid.rowsQuantity);
        this.snake = new Snake_1.default(this.grid);
        window.addEventListener('keydown', this.onKeyDown.bind(this));
        this.generateApple();
    }
    Game.prototype.start = function () {
        window.focus();
        window.requestAnimationFrame(this.startLoop.bind(this));
    };
    Game.prototype.onKeyDown = function (event) {
        if (!this.isChangeDirectionAllowed) {
            return;
        }
        this.isChangeDirectionAllowed = false;
        switch (event.keyCode) {
            case constants_1.KEY_CODE.RIGHT:
                if (this.direction !== constants_1.DIRECTION.LEFT) {
                    this.direction = constants_1.DIRECTION.RIGHT;
                }
                break;
            case constants_1.KEY_CODE.LEFT:
                if (this.direction !== constants_1.DIRECTION.RIGHT) {
                    this.direction = constants_1.DIRECTION.LEFT;
                }
                break;
            case constants_1.KEY_CODE.UP:
                if (this.direction !== constants_1.DIRECTION.DOWN) {
                    this.direction = constants_1.DIRECTION.UP;
                }
                break;
            case constants_1.KEY_CODE.DOWN:
                if (this.direction !== constants_1.DIRECTION.UP) {
                    this.direction = constants_1.DIRECTION.DOWN;
                }
                break;
        }
    };
    Game.prototype.generateApple = function () {
        var emptyCoordinates = this.getEmptyCoordinates();
        var foodCoordinate = emptyCoordinates[Math.floor(Math.random() * (emptyCoordinates.length - 1))];
        this.grid.setCell(foodCoordinate, constants_1.CELL_TYPE.APPLE);
    };
    Game.prototype.getEmptyCoordinates = function () {
        var emptyCoordinates = [];
        for (var row = 0; row < this.grid.rowsQuantity; row++) {
            for (var column = 0; column < this.grid.columnsQuantity; column++) {
                if (this.grid.getCell({ row: row, column: column }) === constants_1.CELL_TYPE.EMPTY) {
                    emptyCoordinates.push({ row: row, column: column });
                }
            }
        }
        return emptyCoordinates;
    };
    Game.prototype.startLoop = function () {
        if (++this.frame % this.speed !== 0) {
            window.requestAnimationFrame(this.startLoop.bind(this));
            return;
        }
        var headRow = this.snake.head.row;
        var headColumn = this.snake.head.column;
        switch (this.direction) {
            case constants_1.DIRECTION.RIGHT:
                headColumn++;
                break;
            case constants_1.DIRECTION.LEFT:
                headColumn--;
                break;
            case constants_1.DIRECTION.UP:
                headRow--;
                break;
            case constants_1.DIRECTION.DOWN:
                headRow++;
                break;
        }
        if (this.checkGameOver({ row: headRow, column: headColumn })) {
            // todo handle game over
            return;
        }
        var isGetApple = this.grid.getCell({ row: headRow, column: headColumn }) === constants_1.CELL_TYPE.APPLE;
        if (isGetApple) {
            this.snake.eat({ row: headRow, column: headColumn });
            this.generateApple();
            this.updateScore(++this.score);
        }
        this.snake.move({ row: headRow, column: headColumn });
        this.view.draw(this.grid.grid);
        this.isChangeDirectionAllowed = true;
        window.requestAnimationFrame(this.startLoop.bind(this));
    };
    Game.prototype.updateScore = function (score) {
        if (this.score % constants_1.SPEED_INCREASE_INTERVAL === 0) {
            this.speed--;
        }
        this.view.updateScore(this.score);
    };
    Game.prototype.checkGameOver = function (snakeHead) {
        var isTouchedBorder = snakeHead.row < 0 || snakeHead.column < 0 || snakeHead.row > this.grid.rowsQuantity - 1 || snakeHead.column > this.grid.columnsQuantity - 1;
        var isTouchedHerself = this.grid.getCell(snakeHead) === constants_1.CELL_TYPE.SNAKE;
        return isTouchedBorder || isTouchedHerself;
    };
    return Game;
}());
exports.default = Game;

},{"../shared/constants":6,"./Grid":2,"./Snake":3,"./View":4}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Grid = /** @class */ (function () {
    function Grid() {
        this._grid = [];
        this._cols = Math.round(window.innerWidth / constants_1.CELL_SIZE) - constants_1.GRID_MARGIN;
        this._rows = Math.round(window.innerHeight / constants_1.CELL_SIZE) - constants_1.GRID_MARGIN;
        for (var row = 0; row < this._rows; row++) {
            this._grid[row] = [];
            for (var column = 0; column < this._cols; column++) {
                this._grid[row][column] = constants_1.CELL_TYPE.EMPTY;
            }
        }
    }
    Object.defineProperty(Grid.prototype, "columnsQuantity", {
        get: function () {
            return this._cols;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "rowsQuantity", {
        get: function () {
            return this._rows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "grid", {
        get: function () {
            return this._grid;
        },
        enumerable: true,
        configurable: true
    });
    Grid.prototype.getCell = function (coordinate) {
        return this._grid[coordinate.row][coordinate.column];
    };
    Grid.prototype.setCell = function (coordinate, type) {
        this._grid[coordinate.row][coordinate.column] = type;
    };
    return Grid;
}());
exports.default = Grid;

},{"../shared/constants":6}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var Snake = /** @class */ (function () {
    function Snake(grid) {
        this.grid = grid;
        this.chain = [];
        this.chain.push(constants_1.START_SNAKE_COORDINATE);
    }
    Object.defineProperty(Snake.prototype, "head", {
        get: function () {
            return this.chain[0];
        },
        enumerable: true,
        configurable: true
    });
    Snake.prototype.eat = function (coordinate) {
        this.chain.unshift(coordinate);
        this.grid.setCell(coordinate, constants_1.CELL_TYPE.SNAKE);
    };
    Snake.prototype.move = function (coordinate) {
        this.chain.unshift(coordinate);
        this.grid.setCell(coordinate, constants_1.CELL_TYPE.SNAKE);
        var nextCoordinate = {
            row: this.chain[this.chain.length - 1].row,
            column: this.chain[this.chain.length - 1].column
        };
        this.grid.setCell(nextCoordinate, constants_1.CELL_TYPE.EMPTY);
        this.chain.pop();
    };
    return Snake;
}());
exports.default = Snake;

},{"../shared/constants":6}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../shared/constants");
var View = /** @class */ (function () {
    function View(cols, rows) {
        this.cols = cols;
        this.rows = rows;
        this.canvas = document.getElementsByClassName('battlefield')[0];
        this.canvas.setAttribute('width', this.cols * constants_1.CELL_SIZE + "px");
        this.canvas.setAttribute('height', this.rows * constants_1.CELL_SIZE + "px");
        this.ctx = this.canvas.getContext('2d');
    }
    View.prototype.draw = function (grid) {
        var _this = this;
        grid.forEach(function (rowArr, row) {
            rowArr.forEach(function (type, column) {
                _this.drawCell({ row: row, column: column }, type);
            });
        });
    };
    View.prototype.updateScore = function (score) {
        // todo implement score draw
    };
    View.prototype.drawCell = function (coordinate, type) {
        this.ctx.fillStyle = constants_1.COLOR[type] || constants_1.COLOR[constants_1.CELL_TYPE.EMPTY];
        this.ctx.fillRect(coordinate.column * constants_1.CELL_SIZE, coordinate.row * constants_1.CELL_SIZE, constants_1.CELL_SIZE, constants_1.CELL_SIZE);
    };
    ;
    return View;
}());
exports.default = View;

},{"../shared/constants":6}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Game_1 = require("./controllers/Game");
window.addEventListener('load', function () {
    var game = new Game_1.default();
    game.start();
});

},{"./controllers/Game":1}],6:[function(require,module,exports){
"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CELL_SIZE = 20;
exports.GRID_MARGIN = 6;
exports.START_SPEED = 10;
exports.SPEED_INCREASE_INTERVAL = 5;
exports.START_SNAKE_COORDINATE = {
    row: 3,
    column: 3
};
var KEY_CODE;
(function (KEY_CODE) {
    KEY_CODE[KEY_CODE["LEFT"] = 37] = "LEFT";
    KEY_CODE[KEY_CODE["UP"] = 38] = "UP";
    KEY_CODE[KEY_CODE["RIGHT"] = 39] = "RIGHT";
    KEY_CODE[KEY_CODE["DOWN"] = 40] = "DOWN";
})(KEY_CODE = exports.KEY_CODE || (exports.KEY_CODE = {}));
var CELL_TYPE;
(function (CELL_TYPE) {
    CELL_TYPE[CELL_TYPE["EMPTY"] = 0] = "EMPTY";
    CELL_TYPE[CELL_TYPE["SNAKE"] = 1] = "SNAKE";
    CELL_TYPE[CELL_TYPE["APPLE"] = 2] = "APPLE";
    CELL_TYPE[CELL_TYPE["CRASH"] = 3] = "CRASH";
})(CELL_TYPE = exports.CELL_TYPE || (exports.CELL_TYPE = {}));
var DIRECTION;
(function (DIRECTION) {
    DIRECTION[DIRECTION["RIGHT"] = 0] = "RIGHT";
    DIRECTION[DIRECTION["LEFT"] = 1] = "LEFT";
    DIRECTION[DIRECTION["DOWN"] = 2] = "DOWN";
    DIRECTION[DIRECTION["UP"] = 3] = "UP";
})(DIRECTION = exports.DIRECTION || (exports.DIRECTION = {}));
exports.COLOR = (_a = {},
    _a[CELL_TYPE.SNAKE] = 'green',
    _a[CELL_TYPE.APPLE] = 'red',
    _a[CELL_TYPE.CRASH] = 'darkred',
    _a[CELL_TYPE.EMPTY] = 'white',
    _a);

},{}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29udHJvbGxlcnMvR2FtZS50cyIsInNyYy9jb250cm9sbGVycy9HcmlkLnRzIiwic3JjL2NvbnRyb2xsZXJzL1NuYWtlLnRzIiwic3JjL2NvbnRyb2xsZXJzL1ZpZXcudHMiLCJzcmMvbWFpbi50cyIsInNyYy9zaGFyZWQvY29uc3RhbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxpREFBMkc7QUFDM0csK0JBQTBCO0FBQzFCLCtCQUEwQjtBQUMxQixpQ0FBNEI7QUFHNUI7SUFVSTtRQU5RLFVBQUssR0FBVyxDQUFDLENBQUM7UUFDbEIsVUFBSyxHQUFXLENBQUMsQ0FBQztRQUNsQixVQUFLLEdBQVcsdUJBQVcsQ0FBQztRQUM1QixjQUFTLEdBQWMscUJBQVMsQ0FBQyxLQUFLLENBQUM7UUFDdkMsNkJBQXdCLEdBQVksSUFBSSxDQUFDO1FBRzdDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxjQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGVBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRTlELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQsb0JBQUssR0FBTDtRQUNJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNmLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJ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QUFULGlCQUFTLFFBS3BCO0FBRVksUUFBQSxLQUFLO0lBQ2QsR0FBQyxTQUFTLENBQUMsS0FBSyxJQUFHLE9BQU87SUFDMUIsR0FBQyxTQUFTLENBQUMsS0FBSyxJQUFHLEtBQUs7SUFDeEIsR0FBQyxTQUFTLENBQUMsS0FBSyxJQUFHLFNBQVM7SUFDNUIsR0FBQyxTQUFTLENBQUMsS0FBSyxJQUFHLE9BQU87UUFDNUIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgeyBDRUxMX1RZUEUsIERJUkVDVElPTiwgS0VZX0NPREUsIFNQRUVEX0lOQ1JFQVNFX0lOVEVSVkFMLCBTVEFSVF9TUEVFRCB9IGZyb20gXCIuLi9zaGFyZWQvY29uc3RhbnRzXCI7XG5pbXBvcnQgR3JpZCBmcm9tIFwiLi9HcmlkXCI7XG5pbXBvcnQgVmlldyBmcm9tIFwiLi9WaWV3XCI7XG5pbXBvcnQgU25ha2UgZnJvbSBcIi4vU25ha2VcIjtcbmltcG9ydCBJQ29vcmRpbmF0ZSBmcm9tIFwiLi4vc2hhcmVkL0lDb29yZGluYXRlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdmlldzogVmlldztcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdyaWQ6IEdyaWQ7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzbmFrZTogU25ha2U7XG4gICAgcHJpdmF0ZSBmcmFtZTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHNjb3JlOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgc3BlZWQ6IG51bWJlciA9IFNUQVJUX1NQRUVEO1xuICAgIHByaXZhdGUgZGlyZWN0aW9uOiBESVJFQ1RJT04gPSBESVJFQ1RJT04uUklHSFQ7XG4gICAgcHJpdmF0ZSBpc0NoYW5nZURpcmVjdGlvbkFsbG93ZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZ3JpZCA9IG5ldyBHcmlkKCk7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBWaWV3KHRoaXMuZ3JpZC5jb2x1bW5zUXVhbnRpdHksIHRoaXMuZ3JpZC5yb3dzUXVhbnRpdHkpO1xuICAgICAgICB0aGlzLnNuYWtlID0gbmV3IFNuYWtlKHRoaXMuZ3JpZCk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLm9uS2V5RG93bi5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLmdlbmVyYXRlQXBwbGUoKTtcbiAgICB9XG5cbiAgICBzdGFydCgpOiB2b2lkIHtcbiAgICAgICAgd2luZG93LmZvY3VzKCk7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5zdGFydExvb3AuYmluZCh0aGlzKSlcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuaXNDaGFuZ2VEaXJlY3Rpb25BbGxvd2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzQ2hhbmdlRGlyZWN0aW9uQWxsb3dlZCA9IGZhbHNlO1xuXG4gICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBLRVlfQ09ERS5SSUdIVDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT09IERJUkVDVElPTi5MRUZUKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gRElSRUNUSU9OLlJJR0hUO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS0VZX0NPREUuTEVGVDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT09IERJUkVDVElPTi5SSUdIVCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IERJUkVDVElPTi5MRUZUO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS0VZX0NPREUuVVA6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uICE9PSBESVJFQ1RJT04uRE9XTikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IERJUkVDVElPTi5VUDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtFWV9DT0RFLkRPV046XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uICE9PSBESVJFQ1RJT04uVVApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBESVJFQ1RJT04uRE9XTjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlQXBwbGUoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGVtcHR5Q29vcmRpbmF0ZXM6IElDb29yZGluYXRlW10gPSB0aGlzLmdldEVtcHR5Q29vcmRpbmF0ZXMoKTtcbiAgICAgICAgY29uc3QgZm9vZENvb3JkaW5hdGU6IElDb29yZGluYXRlID0gZW1wdHlDb29yZGluYXRlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoZW1wdHlDb29yZGluYXRlcy5sZW5ndGggLSAxKSldO1xuXG4gICAgICAgIHRoaXMuZ3JpZC5zZXRDZWxsKGZvb2RDb29yZGluYXRlLCBDRUxMX1RZUEUuQVBQTEUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RW1wdHlDb29yZGluYXRlcygpOiBJQ29vcmRpbmF0ZVtdIHtcbiAgICAgICAgY29uc3QgZW1wdHlDb29yZGluYXRlczogSUNvb3JkaW5hdGVbXSA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IHJvdzogbnVtYmVyID0gMDsgcm93IDwgdGhpcy5ncmlkLnJvd3NRdWFudGl0eTsgcm93KyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGNvbHVtbjogbnVtYmVyID0gMDsgY29sdW1uIDwgdGhpcy5ncmlkLmNvbHVtbnNRdWFudGl0eTsgY29sdW1uKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkLmdldENlbGwoeyByb3csIGNvbHVtbiB9KSA9PT0gQ0VMTF9UWVBFLkVNUFRZKSB7XG4gICAgICAgICAgICAgICAgICAgIGVtcHR5Q29vcmRpbmF0ZXMucHVzaCh7IHJvdywgY29sdW1uIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbXB0eUNvb3JkaW5hdGVzO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhcnRMb29wKCk6IHZvaWQge1xuICAgICAgICBpZiAoKyt0aGlzLmZyYW1lICUgdGhpcy5zcGVlZCAhPT0gMCkge1xuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnN0YXJ0TG9vcC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkUm93OiBudW1iZXIgPSB0aGlzLnNuYWtlLmhlYWQucm93O1xuICAgICAgICBsZXQgaGVhZENvbHVtbjogbnVtYmVyID0gdGhpcy5zbmFrZS5oZWFkLmNvbHVtbjtcblxuICAgICAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDpcbiAgICAgICAgICAgICAgICBoZWFkQ29sdW1uKys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERJUkVDVElPTi5MRUZUOlxuICAgICAgICAgICAgICAgIGhlYWRDb2x1bW4tLTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRElSRUNUSU9OLlVQOlxuICAgICAgICAgICAgICAgIGhlYWRSb3ctLTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRElSRUNUSU9OLkRPV046XG4gICAgICAgICAgICAgICAgaGVhZFJvdysrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2hlY2tHYW1lT3Zlcih7IHJvdzogaGVhZFJvdywgY29sdW1uOiBoZWFkQ29sdW1uIH0pKSB7XG4gICAgICAgICAgICAvLyB0b2RvIGhhbmRsZSBnYW1lIG92ZXJcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNHZXRBcHBsZTogYm9vbGVhbiA9IHRoaXMuZ3JpZC5nZXRDZWxsKHsgcm93OiBoZWFkUm93LCBjb2x1bW46IGhlYWRDb2x1bW4gfSkgPT09IENFTExfVFlQRS5BUFBMRTtcblxuICAgICAgICBpZiAoaXNHZXRBcHBsZSkge1xuICAgICAgICAgICAgdGhpcy5zbmFrZS5lYXQoeyByb3c6IGhlYWRSb3csIGNvbHVtbjogaGVhZENvbHVtbiB9KTtcbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVBcHBsZSgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTY29yZSgrK3RoaXMuc2NvcmUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zbmFrZS5tb3ZlKHsgcm93OiBoZWFkUm93LCBjb2x1bW46IGhlYWRDb2x1bW4gfSk7XG5cbiAgICAgICAgdGhpcy52aWV3LmRyYXcodGhpcy5ncmlkLmdyaWQpO1xuICAgICAgICB0aGlzLmlzQ2hhbmdlRGlyZWN0aW9uQWxsb3dlZCA9IHRydWU7XG5cbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnN0YXJ0TG9vcC5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVNjb3JlKHNjb3JlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuc2NvcmUgJSBTUEVFRF9JTkNSRUFTRV9JTlRFUlZBTCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5zcGVlZC0tO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy52aWV3LnVwZGF0ZVNjb3JlKHRoaXMuc2NvcmUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tHYW1lT3ZlcihzbmFrZUhlYWQ6IElDb29yZGluYXRlKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGlzVG91Y2hlZEJvcmRlcjogYm9vbGVhbiA9IHNuYWtlSGVhZC5yb3cgPCAwIHx8IHNuYWtlSGVhZC5jb2x1bW4gPCAwIHx8IHNuYWtlSGVhZC5yb3cgPiB0aGlzLmdyaWQucm93c1F1YW50aXR5IC0gMSB8fCBzbmFrZUhlYWQuY29sdW1uID4gdGhpcy5ncmlkLmNvbHVtbnNRdWFudGl0eSAtIDE7XG4gICAgICAgIGNvbnN0IGlzVG91Y2hlZEhlcnNlbGY6IGJvb2xlYW4gPSB0aGlzLmdyaWQuZ2V0Q2VsbChzbmFrZUhlYWQpID09PSBDRUxMX1RZUEUuU05BS0U7XG5cbiAgICAgICAgcmV0dXJuIGlzVG91Y2hlZEJvcmRlciB8fCBpc1RvdWNoZWRIZXJzZWxmO1xuICAgIH1cbn1cblxuIiwiaW1wb3J0IHsgQ0VMTF9TSVpFLCBDRUxMX1RZUEUsIEdSSURfTUFSR0lOIH0gZnJvbSBcIi4uL3NoYXJlZC9jb25zdGFudHNcIjtcbmltcG9ydCBJQ29vcmRpbmF0ZSBmcm9tIFwiLi4vc2hhcmVkL0lDb29yZGluYXRlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyaWQge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2dyaWQ6IENFTExfVFlQRVtdW10gPSBbXTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9jb2xzOiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfcm93czogbnVtYmVyO1xuXG4gICAgZ2V0IGNvbHVtbnNRdWFudGl0eSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29scztcbiAgICB9XG5cbiAgICBnZXQgcm93c1F1YW50aXR5KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yb3dzO1xuICAgIH1cblxuICAgIGdldCBncmlkKCk6IENFTExfVFlQRVtdW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ3JpZDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fY29scyA9IE1hdGgucm91bmQod2luZG93LmlubmVyV2lkdGggLyBDRUxMX1NJWkUpIC0gR1JJRF9NQVJHSU47XG4gICAgICAgIHRoaXMuX3Jvd3MgPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lckhlaWdodCAvIENFTExfU0laRSkgLSBHUklEX01BUkdJTjtcblxuICAgICAgICBmb3IgKGxldCByb3c6IG51bWJlciA9IDA7IHJvdyA8IHRoaXMuX3Jvd3M7IHJvdysrKSB7XG4gICAgICAgICAgICB0aGlzLl9ncmlkW3Jvd10gPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgY29sdW1uOiBudW1iZXIgPSAwOyBjb2x1bW4gPCB0aGlzLl9jb2xzOyBjb2x1bW4rKykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2dyaWRbcm93XVtjb2x1bW5dID0gQ0VMTF9UWVBFLkVNUFRZO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0Q2VsbChjb29yZGluYXRlOiBJQ29vcmRpbmF0ZSk6IENFTExfVFlQRSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ncmlkW2Nvb3JkaW5hdGUucm93XVtjb29yZGluYXRlLmNvbHVtbl07XG4gICAgfVxuXG4gICAgc2V0Q2VsbChjb29yZGluYXRlOiBJQ29vcmRpbmF0ZSwgdHlwZTogQ0VMTF9UWVBFKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2dyaWRbY29vcmRpbmF0ZS5yb3ddW2Nvb3JkaW5hdGUuY29sdW1uXSA9IHR5cGU7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQ0VMTF9UWVBFLCBTVEFSVF9TTkFLRV9DT09SRElOQVRFIH0gZnJvbSBcIi4uL3NoYXJlZC9jb25zdGFudHNcIjtcbmltcG9ydCBHcmlkIGZyb20gXCIuL0dyaWRcIjtcbmltcG9ydCBJQ29vcmRpbmF0ZSBmcm9tIFwiLi4vc2hhcmVkL0lDb29yZGluYXRlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNuYWtlIHtcbiAgICBwcml2YXRlIGNoYWluOiBJQ29vcmRpbmF0ZVtdID0gW107XG5cbiAgICBnZXQgaGVhZCgpOiBJQ29vcmRpbmF0ZSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoYWluWzBdO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZ3JpZDogR3JpZCkge1xuICAgICAgICB0aGlzLmNoYWluLnB1c2goU1RBUlRfU05BS0VfQ09PUkRJTkFURSk7XG4gICAgfVxuXG4gICAgZWF0KGNvb3JkaW5hdGU6IElDb29yZGluYXRlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2hhaW4udW5zaGlmdChjb29yZGluYXRlKTtcbiAgICAgICAgdGhpcy5ncmlkLnNldENlbGwoY29vcmRpbmF0ZSwgQ0VMTF9UWVBFLlNOQUtFKTtcbiAgICB9XG5cbiAgICBtb3ZlKGNvb3JkaW5hdGU6IElDb29yZGluYXRlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2hhaW4udW5zaGlmdChjb29yZGluYXRlKTtcbiAgICAgICAgdGhpcy5ncmlkLnNldENlbGwoY29vcmRpbmF0ZSwgQ0VMTF9UWVBFLlNOQUtFKTtcblxuICAgICAgICBjb25zdCBuZXh0Q29vcmRpbmF0ZTogSUNvb3JkaW5hdGUgPSB7XG4gICAgICAgICAgICByb3c6IHRoaXMuY2hhaW5bdGhpcy5jaGFpbi5sZW5ndGggLSAxXS5yb3csXG4gICAgICAgICAgICBjb2x1bW46IHRoaXMuY2hhaW5bdGhpcy5jaGFpbi5sZW5ndGggLSAxXS5jb2x1bW5cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdyaWQuc2V0Q2VsbChuZXh0Q29vcmRpbmF0ZSwgQ0VMTF9UWVBFLkVNUFRZKTtcbiAgICAgICAgdGhpcy5jaGFpbi5wb3AoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDRUxMX1NJWkUsIENFTExfVFlQRSwgQ09MT1IgfSBmcm9tIFwiLi4vc2hhcmVkL2NvbnN0YW50c1wiO1xuaW1wb3J0IElDb29yZGluYXRlIGZyb20gXCIuLi9zaGFyZWQvSUNvb3JkaW5hdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlldyB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNvbHM6IG51bWJlciwgcHJpdmF0ZSByZWFkb25seSByb3dzOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYmF0dGxlZmllbGQnKVswXTtcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0QXR0cmlidXRlKCd3aWR0aCcsIGAke3RoaXMuY29scyAqIENFTExfU0laRX1weGApO1xuICAgICAgICB0aGlzLmNhbnZhcy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke3RoaXMucm93cyAqIENFTExfU0laRX1weGApO1xuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgfVxuXG4gICAgZHJhdyhncmlkOiBDRUxMX1RZUEVbXVtdKTogdm9pZCB7XG4gICAgICAgIGdyaWQuZm9yRWFjaCgocm93QXJyOiBbXSwgcm93OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHJvd0Fyci5mb3JFYWNoKCh0eXBlOiBDRUxMX1RZUEUsIGNvbHVtbjogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3Q2VsbCh7IHJvdywgY29sdW1uIH0sIHR5cGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZVNjb3JlKHNjb3JlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgLy8gdG9kbyBpbXBsZW1lbnQgc2NvcmUgZHJhd1xuICAgIH1cblxuICAgIHByaXZhdGUgZHJhd0NlbGwoY29vcmRpbmF0ZTogSUNvb3JkaW5hdGUsIHR5cGU6IENFTExfVFlQRSk6IHZvaWQge1xuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBDT0xPUlt0eXBlXSB8fCBDT0xPUltDRUxMX1RZUEUuRU1QVFldO1xuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdChjb29yZGluYXRlLmNvbHVtbiAqIENFTExfU0laRSwgY29vcmRpbmF0ZS5yb3cgKiBDRUxMX1NJWkUsIENFTExfU0laRSwgQ0VMTF9TSVpFKTtcbiAgICB9O1xufVxuIiwiaW1wb3J0IEdhbWUgZnJvbSAnLi9jb250cm9sbGVycy9HYW1lJztcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZ2FtZSA9IG5ldyBHYW1lKCk7XG5cbiAgICBnYW1lLnN0YXJ0KCk7XG59KTtcbiIsImltcG9ydCBJQ29vcmRpbmF0ZSBmcm9tIFwiLi9JQ29vcmRpbmF0ZVwiO1xuXG5leHBvcnQgY29uc3QgQ0VMTF9TSVpFOiBudW1iZXIgPSAyMDtcbmV4cG9ydCBjb25zdCBHUklEX01BUkdJTjogbnVtYmVyID0gNjtcbmV4cG9ydCBjb25zdCBTVEFSVF9TUEVFRDogbnVtYmVyID0gMTA7XG5leHBvcnQgY29uc3QgU1BFRURfSU5DUkVBU0VfSU5URVJWQUw6IG51bWJlciA9IDU7XG5leHBvcnQgY29uc3QgU1RBUlRfU05BS0VfQ09PUkRJTkFURTogSUNvb3JkaW5hdGUgPSB7XG4gICAgcm93OiAzLFxuICAgIGNvbHVtbjogM1xufTtcblxuZXhwb3J0IGVudW0gS0VZX0NPREUge1xuICAgIExFRlQgPSAzNyxcbiAgICBVUCA9IDM4LFxuICAgIFJJR0hUID0gMzksXG4gICAgRE9XTiA9IDQwXG59XG5cbmV4cG9ydCBlbnVtIENFTExfVFlQRSB7XG4gICAgRU1QVFksXG4gICAgU05BS0UsXG4gICAgQVBQTEUsXG4gICAgQ1JBU0hcbn1cblxuZXhwb3J0IGVudW0gRElSRUNUSU9OIHtcbiAgICBSSUdIVCxcbiAgICBMRUZULFxuICAgIERPV04sXG4gICAgVVBcbn1cblxuZXhwb3J0IGNvbnN0IENPTE9SID0ge1xuICAgIFtDRUxMX1RZUEUuU05BS0VdOiAnZ3JlZW4nLFxuICAgIFtDRUxMX1RZUEUuQVBQTEVdOiAncmVkJyxcbiAgICBbQ0VMTF9UWVBFLkNSQVNIXTogJ2RhcmtyZWQnLFxuICAgIFtDRUxMX1RZUEUuRU1QVFldOiAnd2hpdGUnXG59O1xuIl19
